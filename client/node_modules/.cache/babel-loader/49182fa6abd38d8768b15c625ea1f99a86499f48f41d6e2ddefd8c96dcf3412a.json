{"ast":null,"code":"var _jsxFileName = \"D:\\\\COS40004\\\\COS40004_Project\\\\client\\\\src\\\\Query.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from \"react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction Query() {\n  _s();\n  const [devices, setDevices] = useState([]);\n  const [states, setStates] = useState([]);\n  const [selectedDevice, setSelectedDevice] = useState(\"\");\n  const [selectedState, setSelectedState] = useState(\"\");\n  const [deviceData, setDeviceData] = useState([]);\n  const sensorProperties = {\n    BME: [\"Temperature\", \"Humidity\", \"Pressure\", \"Gas\"],\n    NPU: [\"Acc-X\", \"Acc-Y\", \"Acc-Z\", \"Gyro-X\", \"Gyro-Y\", \"Gyro-Z\"]\n  };\n  useEffect(() => {\n    fetch(\"/devices\").then(response => response.json()).then(data => setDevices(data));\n    fetch(\"/states\").then(response => response.json()).then(data => setStates(data));\n  }, []);\n  const handleDeviceChange = async event => {\n    setSelectedDevice(event.target.value);\n  };\n  const handleStateChange = async event => {\n    setSelectedState(event.target.value);\n  };\n  const updateData = () => {\n    if (selectedDevice) {\n      fetch(`/boards/device/${selectedDevice}`).then(response => response.json()).then(data => {\n        if (data.sensors) {\n          const filteredData = data.sensors.filter(sensor => checkStateForSensor(sensor));\n          console.log(data);\n          setDeviceData(filteredData);\n        } else {\n          console.log(\"Received data does not contain sensors:\", data);\n        }\n      }).catch(error => console.error(\"Failed to fetch data:\", error));\n    }\n  };\n\n  //   const checkStateForBoard = (board) => {\n  //     console.log(board);\n  //     for (let sensor of board.sensors) {\n  //       if (sensor.type === \"i2c\" && Array.isArray(sensor.value)) {\n  //         const sensorProps = sensorProperties[sensor.name];\n  //         for (let i = 0; i < sensor.value.length; i++) {\n  //           const sensorName = `${sensor.name}-${sensorProps[i]}`.toLowerCase();\n  //           const sensorValue = sensor.value[i];\n  //           if (checkStateForSensor(sensorName, sensorValue)) {\n  //             return true;\n  //           }\n  //         }\n  //       } else {\n  //         if (checkStateForSensor(sensor.name, sensor.value)) {\n  //           return true;\n  //         }\n  //       }\n  //     }\n  //     return false;\n  //   };\n\n  const checkStateForSensor = (sensorName, sensorValue) => {\n    var _devices$find;\n    console.log(sensorName);\n    const deviceName = (_devices$find = devices.find(device => device._id === selectedDevice)) === null || _devices$find === void 0 ? void 0 : _devices$find.name;\n    const matchingStates = states.filter(state => state.device_name.toLowerCase() === deviceName.toLowerCase() && state.sensor_name.toLowerCase() === sensorName.toLowerCase());\n    for (let state of matchingStates) {\n      if (state.name === selectedState) {\n        switch (state.condition) {\n          case \"<\":\n            return sensorValue < state.parameter;\n          case \">\":\n            return sensorValue > state.parameter;\n          case \"<=\":\n            return sensorValue <= state.parameter;\n          case \">=\":\n            return sensorValue >= state.parameter;\n          case \"=\":\n            return sensorValue === state.parameter;\n          default:\n            return false;\n        }\n      }\n    }\n    return false;\n  };\n  useEffect(updateData, [selectedDevice, selectedState]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"Query Page\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n      onChange: handleDeviceChange,\n      children: [/*#__PURE__*/_jsxDEV(\"option\", {\n        children: \"--Select a device--\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 9\n      }, this), devices.map(device => /*#__PURE__*/_jsxDEV(\"option\", {\n        value: device._id,\n        children: device.name\n      }, device._id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 11\n      }, this))]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n      onChange: handleStateChange,\n      children: [/*#__PURE__*/_jsxDEV(\"option\", {\n        children: \"--Select a state--\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 9\n      }, this), states.filter(state => {\n        var _devices$find2;\n        return state.device_name === ((_devices$find2 = devices.find(device => device._id === selectedDevice)) === null || _devices$find2 === void 0 ? void 0 : _devices$find2.name);\n      }).map(state => /*#__PURE__*/_jsxDEV(\"option\", {\n        value: state.name,\n        children: state.name\n      }, state._id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 13\n      }, this))]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 7\n    }, this), deviceData.map(board => /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: new Date(board.timestamp).toLocaleString()\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 11\n      }, this), board.sensors.map((sensor, index) => /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [sensor.name, \": \", sensor.value]\n      }, index, true, {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 13\n      }, this))]\n    }, board._id, true, {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 9\n    }, this))]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 107,\n    columnNumber: 5\n  }, this);\n}\n_s(Query, \"Ot/U8/8FpIG8W7iHp6MdXwlT2LE=\");\n_c = Query;\nexport { Query };\nvar _c;\n$RefreshReg$(_c, \"Query\");","map":{"version":3,"names":["React","useState","useEffect","jsxDEV","_jsxDEV","Query","_s","devices","setDevices","states","setStates","selectedDevice","setSelectedDevice","selectedState","setSelectedState","deviceData","setDeviceData","sensorProperties","BME","NPU","fetch","then","response","json","data","handleDeviceChange","event","target","value","handleStateChange","updateData","sensors","filteredData","filter","sensor","checkStateForSensor","console","log","catch","error","sensorName","sensorValue","_devices$find","deviceName","find","device","_id","name","matchingStates","state","device_name","toLowerCase","sensor_name","condition","parameter","children","fileName","_jsxFileName","lineNumber","columnNumber","onChange","map","_devices$find2","board","Date","timestamp","toLocaleString","index","_c","$RefreshReg$"],"sources":["D:/COS40004/COS40004_Project/client/src/Query.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\n\r\nfunction Query() {\r\n  const [devices, setDevices] = useState([]);\r\n  const [states, setStates] = useState([]);\r\n  const [selectedDevice, setSelectedDevice] = useState(\"\");\r\n  const [selectedState, setSelectedState] = useState(\"\");\r\n  const [deviceData, setDeviceData] = useState([]);\r\n\r\n  const sensorProperties = {\r\n    BME: [\"Temperature\", \"Humidity\", \"Pressure\", \"Gas\"],\r\n    NPU: [\"Acc-X\", \"Acc-Y\", \"Acc-Z\", \"Gyro-X\", \"Gyro-Y\", \"Gyro-Z\"],\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetch(\"/devices\")\r\n      .then((response) => response.json())\r\n      .then((data) => setDevices(data));\r\n    fetch(\"/states\")\r\n      .then((response) => response.json())\r\n      .then((data) => setStates(data));\r\n  }, []);\r\n\r\n  const handleDeviceChange = async (event) => {\r\n    setSelectedDevice(event.target.value);\r\n  };\r\n\r\n  const handleStateChange = async (event) => {\r\n    setSelectedState(event.target.value);\r\n  };\r\n\r\n  const updateData = () => {\r\n    if (selectedDevice) {\r\n      fetch(`/boards/device/${selectedDevice}`)\r\n        .then((response) => response.json())\r\n        .then((data) => {\r\n          if (data.sensors) {\r\n            const filteredData = data.sensors.filter((sensor) =>\r\n              checkStateForSensor(sensor)\r\n            );\r\n            console.log(data);\r\n            setDeviceData(filteredData);\r\n          } else {\r\n            console.log(\"Received data does not contain sensors:\", data);\r\n          }\r\n        })\r\n        .catch((error) => console.error(\"Failed to fetch data:\", error));\r\n    }\r\n  };\r\n\r\n  //   const checkStateForBoard = (board) => {\r\n  //     console.log(board);\r\n  //     for (let sensor of board.sensors) {\r\n  //       if (sensor.type === \"i2c\" && Array.isArray(sensor.value)) {\r\n  //         const sensorProps = sensorProperties[sensor.name];\r\n  //         for (let i = 0; i < sensor.value.length; i++) {\r\n  //           const sensorName = `${sensor.name}-${sensorProps[i]}`.toLowerCase();\r\n  //           const sensorValue = sensor.value[i];\r\n  //           if (checkStateForSensor(sensorName, sensorValue)) {\r\n  //             return true;\r\n  //           }\r\n  //         }\r\n  //       } else {\r\n  //         if (checkStateForSensor(sensor.name, sensor.value)) {\r\n  //           return true;\r\n  //         }\r\n  //       }\r\n  //     }\r\n  //     return false;\r\n  //   };\r\n\r\n  const checkStateForSensor = (sensorName, sensorValue) => {\r\n    console.log(sensorName);\r\n    const deviceName = devices.find(\r\n      (device) => device._id === selectedDevice\r\n    )?.name;\r\n    const matchingStates = states.filter(\r\n      (state) =>\r\n        state.device_name.toLowerCase() === deviceName.toLowerCase() &&\r\n        state.sensor_name.toLowerCase() === sensorName.toLowerCase()\r\n    );\r\n\r\n    for (let state of matchingStates) {\r\n      if (state.name === selectedState) {\r\n        switch (state.condition) {\r\n          case \"<\":\r\n            return sensorValue < state.parameter;\r\n          case \">\":\r\n            return sensorValue > state.parameter;\r\n          case \"<=\":\r\n            return sensorValue <= state.parameter;\r\n          case \">=\":\r\n            return sensorValue >= state.parameter;\r\n          case \"=\":\r\n            return sensorValue === state.parameter;\r\n          default:\r\n            return false;\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  };\r\n\r\n  useEffect(updateData, [selectedDevice, selectedState]);\r\n\r\n  return (\r\n    <div>\r\n      <h1>Query Page</h1>\r\n\r\n      <select onChange={handleDeviceChange}>\r\n        <option>--Select a device--</option>\r\n        {devices.map((device) => (\r\n          <option key={device._id} value={device._id}>\r\n            {device.name}\r\n          </option>\r\n        ))}\r\n      </select>\r\n\r\n      <select onChange={handleStateChange}>\r\n        <option>--Select a state--</option>\r\n        {states\r\n          .filter(\r\n            (state) =>\r\n              state.device_name ===\r\n              devices.find((device) => device._id === selectedDevice)?.name\r\n          )\r\n          .map((state) => (\r\n            <option key={state._id} value={state.name}>\r\n              {state.name}\r\n            </option>\r\n          ))}\r\n      </select>\r\n\r\n      {deviceData.map((board) => (\r\n        <div key={board._id}>\r\n          <h2>{new Date(board.timestamp).toLocaleString()}</h2>\r\n          {board.sensors.map((sensor, index) => (\r\n            <p key={index}>\r\n              {sensor.name}: {sensor.value}\r\n            </p>\r\n          ))}\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport { Query };\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}